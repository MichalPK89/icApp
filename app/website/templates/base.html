<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>App</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    {% load static %}
    <link rel="shortcut icon" type="image/png" href="{% static 'images/favicon.png' %}">

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" href="https://cdn.datatables.net/2.1.7/css/dataTables.dataTables.min.css" />
    <script src="https://cdn.datatables.net/2.1.7/js/dataTables.min.js"></script>

    <!-- Custom spinner styles -->
    <style>
        .spinner {
            display: inline-block;
            width: 50px;
            height: 50px;
            border: 5px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            border-top-color: #3498db;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .loading-container {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100px;
        }

        /* Hide the table content initially */
        #table-content {
            display: none;
        }
    </style>
</head>

<body>
    {% include 'navbar.html' %}
    <div class="container">
        <br>

        <!-- Loading spinner -->
        <div id="loading-container" class="loading-container">
            <div class="spinner"></div>
        </div>

        <!-- Content of the table (initially hidden while loading) -->
        <div id="table-content">
            {% block content %}
            {% endblock %}
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

    <!-- DataTables Initialization Script -->
    <script>
        $(document).ready(function () {
            $('#myTable').DataTable();
        });

        // Function to fetch table data asynchronously and show spinner
        function fetchTableData(url, tableBodyId, columnNames) {
            // Show loading spinner
            $('#loading-container').show();
            $('#table-content').hide();

            fetch(url, { method: 'GET', headers: { 'Content-Type': 'application/json' } })
                .then(response => response.json())
                .then(data => {
                    // Hide the spinner and show the table
                    $('#loading-container').hide();
                    $('#table-content').show();

                    // Populate the table body dynamically
                    let tbody = document.getElementById(tableBodyId);
                    tbody.innerHTML = '';  // Clear the existing rows

                    data.rows.forEach(function (row) {
                        let tableRow = '<tr>';
                        columnNames.forEach(function (col) {
                            tableRow += `<td>${row[col] || ''}</td>`;
                        });
                        tableRow += '</tr>';
                        tbody.innerHTML += tableRow;
                    });

                    // Reinitialize DataTables after loading data
                    $('#myTable').DataTable();
                })
                .catch(error => {
                    console.error('Error:', error);
                    // Optionally display an error message
                });
        }
    </script>
</body>
</html>
