<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>App</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    {% load static %}
    <link rel="shortcut icon" type="image/png" href="{% static 'images/favicon.png' %}">

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" href="https://cdn.datatables.net/2.1.7/css/dataTables.dataTables.min.css" />
    <script src="https://cdn.datatables.net/2.1.7/js/dataTables.min.js"></script>

    {% block extra_styles %}
    <style>
        .spinner {
            display: inline-block;
            width: 50px;
            height: 50px;
            border: 5px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            border-top-color: #3498db;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .loading-container {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100px;
        }

        /* Hide the table content initially */
        #table-content {
            display: none;
        }
    </style>
    {% endblock %}
</head>

<body>
    {% include 'navbar.html' %}
    <div class="container">
        </br>
        {% block content %}
        {% endblock %}
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

    {% block extra_scripts %}
    <script>
        $(document).ready(function () {
            // Fetch data for the table
            fetchTableData("{% url 'get_vat_payers' %}", 'vat-payers-body');

            function fetchTableData(url, tableBodyId) {
                $('#loading-container').show();
                $('#table-content').hide();

                fetch(url, { method: 'GET', headers: { 'Content-Type': 'application/json' } })
                    .then(response => response.json())
                    .then(data => {
                        $('#loading-container').hide();
                        $('#table-content').show();

                        let tbody = document.getElementById(tableBodyId);
                        tbody.innerHTML = '';  // Clear existing rows

                        // Populate the table body with fetched data
                        data.rows.forEach(row => {
                            let tableRow = '<tr>';
                            for (let key in row) {
                                tableRow += `<td>${row[key] || ''}</td>`;
                            }
                            tableRow += '</tr>';
                            tbody.innerHTML += tableRow;
                        });

                        // Initialize DataTable
                        const newTable = $('table.display').DataTable({
                            // If you want to customize column rendering or other options, do it here
                        });

                        // Filter functionality for each column
                        $('#filterTable input').on('keyup change', function () {
                            const colIndex = $(this).parent().index();
                            newTable.column(colIndex).search(this.value).draw();
                        });
                    })
                    .catch(error => {
                        console.error('Error:', error);
                    });
            }
        });

    </script>

    {% endblock %}

</body>
</html>
